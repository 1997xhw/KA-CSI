# 意见4 完整修改与回复方案

---

## 一、第2点：相位解卷绕与去线性漂移——给出公式并引用[29]

参考文献[29] Quy et al. (2025) 中给出了相位解卷绕的公式（该文式(7)）。去线性漂移采用常规“减最小二乘拟合直线”的做法即可，与[29]的相位预处理思路一致。以下正文可直接加入“幅相处理”或“相位校正”小节。

### 1. 相位解卷绕公式（可引用[29]）

CSI 相位通常被包裹在 [−π, π] 或 [0, 2π] 内，解卷绕旨在消除跨边界跳变、得到连续相位序列。采用递推形式[29]：

$$\hat{\phi}_i = \phi_i + 2\pi \left\lfloor \frac{\hat{\phi}_{i-1} - \phi_i}{2\pi} \right\rfloor$$

其中 \(\phi_i\) 为第 \(i\) 点的原始相位，\(\hat{\phi}_i\) 为解卷绕后的相位，\(\hat{\phi}_{i-1}\) 为前一点解卷绕结果，\(\lfloor\cdot\rfloor\) 为向下取整。初始点可取 \(\hat{\phi}_0 = \phi_0\)。

（若正文用行内公式，可写：\(\hat{\phi}_i = \phi_i + 2\pi \lfloor (\hat{\phi}_{i-1} - \phi_i) / 2\pi \rfloor\)，并注明“参见[29]”。）

### 2. 去线性漂移公式

解卷绕后，为削弱收发端载波不同步与硬件偏差带来的线性相位漂移，对序列做去线性趋势处理。设解卷绕相位序列为 \(\hat{\phi}(t_n)\)，\(n=1,\ldots,N\)，以最小二乘拟合直线 \(a t_n + b\)，则去漂移后的相位为：

$$\tilde{\phi}(t_n) = \hat{\phi}(t_n) - (a t_n + b)$$

其中 \(a,b\) 由 \(\min_{a,b} \sum_{n=1}^{N} \big(\hat{\phi}(t_n) - (a t_n + b)\big)^2\) 确定，从而突出与人体动作相关的相位变化。该做法与常见 CSI 相位预处理及[29]中幅相预处理流程一致。

**正文中可写一句**：相位解卷绕采用递推形式见式(×)，去线性漂移采用上述最小二乘减趋势，具体可参考 CSI 相位预处理文献[29]。

---

## 二、第3点：数据规模（StanWiFi 577）的解释——参考 Quy 等 2025 的表述

Quy et al. (2025) 对 StanWiFi 的表述要点：StanWiFi 由 Yousefi et al. (2017) 采集，包含 6 类活动、6 名受试者、每人每类约 20 次，**原始记录共 577 个样本**；该文采用**滑窗扩增**（窗口长度 1000、步长 150），将 577 条记录扩增至 3119 条用于训练与评估，并指出该数据集在 CSI-HAR 领域被广泛用作公开基准。

**可用于回复或正文的表述：**

- **回复审稿人**：StanWiFi 为 Yousefi 等提出的公开基准数据集，原始记录为 577 个样本（6 类活动、6 名受试者、每人每类约 20 次），与 Quy 等[29]及多篇文献中的描述一致。为增强训练稳定性并与现有工作可比，本文与[29]等做法一致，采用滑窗等数据扩增手段，在原始 577 条基础上生成更多训练/验证样本，用于方法对比与消融；该数据集在 CSI-HAR 领域被广泛采用，结论在既有基准规模下具有可比性与参考价值。

- **正文（实验或数据部分）可补充一句**：StanWiFi 为公开基准数据集，原始样本数为 577[16]，本文采用滑窗等扩增方式与文献[29]等保持一致，以利于与已有方法公平对比。

---

## 三、跨环境验证的说明（MultiEnv）

意见中提到“未进行跨环境、跨设备的泛化性验证”。本文**已使用 MultiEnv 在办公室、大厅等不同场景下进行实验**，即已包含跨环境验证，需在回复中明确写出。

**建议在回复中增加：**

本文已在 **MultiEnv** 数据集上进行了**跨环境**评估：该数据集包含办公室（Office）、大厅（Hall）等不同室内场景，部分设置还包含 NLOS 条件；表×（或表3）给出了在办公室与大厅两种环境下的识别结果，表明模型在不同场景下均能保持较好性能，**跨环境泛化性已在实验中体现**。跨设备（不同网卡/终端）的泛化性拟在后续工作中结合更多硬件配置进一步验证。

---

## 四、意见4 的完整回复（供复制到外审意见.md）

以下为针对意见4 的整合回复，可直接附在意见4 后使用。

**回复：**  
感谢审稿人的细致意见。（1）**卡尔曼滤波 Q、R 参数**：已在正文×节补充过程噪声协方差 Q 与观测噪声协方差 R 的设置依据，并引用卡尔曼滤波用于 CSI 状态估计的文献[28]。（2）**相位解卷绕与去线性漂移**：已在幅相处理/相位校正处补充**相位解卷绕**的递推公式（与文献[29] Quy 等一致）及**去线性漂移**的最小二乘减趋势公式，并引用[29]。（3）**数据规模（StanWiFi 577）**：StanWiFi 为领域内广泛使用的公开基准数据集，原始记录为 577 个样本（6 类活动、6 名受试者等），与 Quy 等[29]及 Yousefi 等原文献描述一致；本文采用与[29]等相同的滑窗等扩增策略，在原始 577 条基础上生成更多样本用于训练与评估，结论在既有基准规模下具有可比性。（4）**跨环境验证**：本文已在 **MultiEnv** 数据集上进行**跨环境**评估，该数据集包含办公室、大厅等不同场景，表×给出了两场景下的结果，表明模型在不同环境下均能保持较好性能；跨设备泛化拟在后续工作中进一步验证。（5）**可视化（缺图）**：接受审稿人建议，将在可行范围内在修订稿或后续工作中补充 CSI 时频图、注意力权重热力图等分析图，以增强可读性。（6）**公式与可复现性**：已对式(4)–(6)中相对位置编码的 \(f(\cdot)\) 作统一界定（可学习或周期函数择一并在全文一致）；对式(12) KANLinear 的基函数形式与初始化方式在正文或附录中作了补充，便于复现。（7）**文献与对比**：已在引言/相关工作中补充对 Transformer 在 CSI-HAR 中应用的近期进展的总结，并对 THAT、RGANet 等对比方法在领域中的位置作了说明；对 LSTM 等缺失的 Pre/Recall 值，已尽量从原文献补全或已在表中注明“原文献未给出”。

---

## 五、其他各点的具体解决方案（除缺图外）

| 审稿意见 | 解决方案 |
|----------|----------|
| 式(4)–(6) 中 f(.) 同时为周期函数与可学习函数、前后矛盾 | 见下文“六、式(4)–(6) 中 f(.) 矛盾的具体修改位置”。 |
| 式(12) KANLinear 未说明基函数形式与初始化 | 在模型或方法小节补充一句：KANLinear 中基函数采用**小波基**（如 Mexican Hat、Morlet 等，与 WaveletKAN 实现一致），可学习尺度与平移参数；**初始化**：线性权重采用 Kaiming 初始化，小波系数在给定尺度下均匀初始化，尺度与平移初值取 1 与 0。若篇幅紧张可放附录。 |
| 引言对 Transformer 在 CSI-HAR 中最新进展总结不足 | 在引言或相关工作增加 1–2 段：综述近年来将 Transformer/注意力用于 CSI-HAR 的代表性工作（如 THAT、WiTransformer、CTS-AM 等），并说明本文在双流、幅相融合与 KAN-GRN 上的区别与改进。 |
| THAT、RGANet 是否为领域 SOTA 未说明 | 在实验或相关工作中加入一句：THAT、RGANet 等为 CSI-HAR 领域常用对比方法/近年代表性方法，本文选取其作为基线以与现有文献结果可比；若某篇为某数据集上 SOTA，可注明“在××数据集上为当前 SOTA 之一”。 |
| LSTM 等缺少 Pre、Recall | 若原文献未给出：在表注中写“LSTM 的 Pre/Recall 原文献未报告”；若能从原文献或复现得到，则补入表中。 |

---

## 六、式(4)–(6) 中 f(.) 矛盾的具体修改位置

审稿人指出：式(4)–(6) 描述相对位置编码时，文中将 \(f(\cdot)\) 既说成周期函数又说成可学习函数，前后矛盾。您文中**实际出现矛盾的位置**在“双通道特征提取”小节、介绍 **LPE（可学习位置编码）与相对位置矩阵** 的那一段。

### 1. 在正文中的位置（对应您 Word 里的“双通道特征提取”/“在特征通道维度方面，模型结合了MRPT与LPE”段）

- **章节**：模型部分 → 双通道特征提取 → “在特征通道维度方面，模型结合了MRPT(图3)与LPE”这一段。
- **具体句子**：在相对位置矩阵公式下方的**符号说明**里，有一句：
  - **原句**：“输入特征矩阵；为加入相对位置编码后的特征矩阵; 为相对位置编码；**为周期函数，用于将相对距离映射为可加性偏置。**”

这里把公式里表示“相对位置编码”或映射关系的符号（审稿人称为 f(.)）写成了**周期函数**，但全文其他地方以及模型名称都是 **LPE（可学习位置编码）**，因此产生矛盾。

### 2. 应改成什么（只改这一处即可统一）

**方案 A（推荐，与“可学习位置编码”一致）**

- **原句**：  
  …… 为相对位置编码；**为周期函数，用于将相对距离映射为可加性偏置。**

- **改为**：  
  …… 为相对位置编码；**为可学习的映射函数（由网络参数表示），用于将相对距离映射为可加性偏置。** 本文 LPE 采用可学习参数实现，即由训练得到，而非固定周期函数。

这样式(4)–(6) 中的该符号就与全文“可学习位置编码”的表述一致，不再出现“周期函数”与“可学习”并存的说法。

**方案 B（若您希望保留“周期”的数学形式、但仍强调实现是可学习）**

- **改为**：  
  …… 为相对位置编码；**可为周期函数（如 sin/cos）或由可学习参数参数化的映射。** 本文实现中采用可学习参数形式，即 LPE 由网络学习得到。

两种方案任选其一即可，**建议用方案 A**，更简单且与“LPE=可学习”完全一致。

### 3. 建议再检查的一处

- 在**同一小节**或**式(4)–(6) 附近**若还有“周期”“periodic”“sin/cos”等描述该相对位置编码的句子，请一并改为“可学习映射”或删除周期函数的说法，保证全文只保留一种定义。

---

## 八、双流建模段落的检查与修改稿（式(4)(5)(6) 与 LPE 统一）

### 检查结论

1. **式(6) 与文字矛盾**  
   - 您写的是：\(f(\cdot) \in \{\sin, \cos\}\)（式(6)）以及“\(f(\cdot)\) 为周期函数”。  
   - 但全文和模型名称均为 **LPE（可学习位置编码）**，实现为可学习参数，不是固定的 sin/cos。  
   - **处理**：删除或改写式(6)，并将“周期函数”改为“可学习映射”，使式(4)(5)(6) 与 LPE 一致。

2. **注意力公式**  
   - 标准写法为 \(\mathrm{Attention}(Q,K,V) = \mathrm{softmax}(QK^\top / \sqrt{d_k}) V\)。  
   - 若您当前写的是 “softmax(QK^T/d_k)” 或 “softmaxQKTdk”，建议补上 **\(\sqrt{d_k}\)** 和 **\(V\)**，即分母为 \(\sqrt{d_k}\)，整体再右乘 \(V\)。

3. **其余**  
   - 式(4) \(X'=X+P\)、式(5) \(P_{ij}=f(i-j)\) 可保留；仅需统一 \(f(\cdot)\) 为“可学习映射”即可。

### 修改后的段落（可直接替换）

在双流建模阶段，振幅与相位特征被分别输入到两条并行分支中，并在时间维度与特征维度进行差异化建模，以实现对 Wi-Fi CSI 多模态特征的充分挖掘。时间通道维度结合了 MCAT 与 GRE。与传统的单纯 Transformer 不同，MCAT（图3）不仅包含多头自注意力机制以捕捉全局依赖关系：

$$\mathrm{Attention}(Q,K,V) = \mathrm{softmax}\left(\frac{QK^\top}{\sqrt{d_k}}\right) V \quad \text{（式3）}$$

其中 \(Q\) 为查询矩阵，\(K\) 为键矩阵，\(V\) 为值矩阵，\(d_k\) 为键/查询维度；softmax 对每个查询在键维做行归一化。

同时还引入了多尺度卷积残差模块[23]，使得模型能够在保留全局信息的同时，强化局部动态特征的提取。相比于只使用注意力机制，MCAT 在复杂动作识别场景下能够更好地兼顾长时序依赖与短时局部特征，从而提升时序特征的鲁棒性。GRE 单元则通过门控机制在时间维度上实现对关键帧的自适应选择，这一设计区别于传统残差连接，能够有效抑制冗余时序信息，使模型在捕捉长时间动作动态时避免信息过载。

在特征通道维度方面，模型结合了 MRPT（图3）与 LPE。传统的通道注意力方法往往仅在单尺度或全局范围内进行加权，难以兼顾局部与整体的通道依赖关系。LPE 通过引入相对位置矩阵：

$$X' = X + P \quad \text{（式4）}$$
$$P_{ij} = f(i-j) \quad \text{（式5）}$$

其中 \(X\) 为输入特征矩阵，\(X'\) 为加入相对位置编码后的特征矩阵，\(P\) 为相对位置编码；**\(f(\cdot)\) 为可学习的映射函数（由网络参数表示），用于将相对距离 \((i-j)\) 映射为可加性偏置。本文 LPE 采用可学习参数实现，即由训练得到，而非固定周期函数。**

强化了通道特征的位置信息，使得 CSI 特征在时间域和特征域均具备更强的顺序感知能力。而 MRPT 在传统投影–融合机制的基础上，设计了多尺度残差投影结构，分别进行尺度级与全局级的跨通道信息整合。这一设计相较于单一注意力机制[24]，能够更好地实现不同尺度通道特征的互补性与判别性，提升模型的整体表达能力。

---

**说明**：  
- 已删除原式(6) “\(f(\cdot) \in \{\sin, \cos\}\)”，避免与可学习 LPE 矛盾。  
- 符号说明中已将 “\(f(\cdot)\) 为周期函数” 改为 “\(f(\cdot)\) 为可学习的映射函数……本文 LPE 采用可学习参数实现……而非固定周期函数”。  
- 若您希望保留式(6) 的编号，可将式(6) 改为：**“\(f(\cdot)\) 由可学习参数（如嵌入或线性映射）实现。”** 不再出现 sin/cos 或周期函数。

---

## 七、参考文献 [29] 的完整著录（供参考文献表）

Quy T D, Lin C Y, Shih T K. Enhanced human activity recognition using wi-fi sensing: Leveraging phase and amplitude with attention mechanisms[J]. Sensors, 2025, 25(4): 1038.
