# 论文与代码对应说明

本文档说明论文《基于双通道特征融合的Wi-Fi CSI人体行为识别》中提出的 **PA-TCNet** 模型与 KA-CSI 代码库的对应关系，便于复现与对照。

---

## 1. 论文概要

- **题目**：基于双通道特征融合的Wi-Fi CSI人体行为识别  
- **作者**：卫嘉琪，陈亮，梁颖（西安工程大学计算机科学学院）  
- **模型名称**：PA-TCNet (Phase-Amplitude Time-Channel Network)  
- **核心思想**：双通道（振幅 + 相位）→ 时间/通道双维建模（GRE + MCAT；LPE + MRPT）→ 轻量融合（DWConv）→ **KAN-GRN** 非线性融合 → 分类  

**主要贡献**：  
1. 引入相位信息，与振幅构成双流特征；  
2. 双流 Transformer：LPE（可学习相对位置编码）+ 相对位置注意力（MRPT），增强时空与通道依赖；  
3. 使用 KAN 进行幅相非线性融合（KAN-GRN），提升细粒度行为区分能力。  

**数据集**：StanWiFi、MultiEnv（办公室/大厅）、自建 SimAct（挥手、招手、推、拉、坐下、蹲下等 6 类）。  

**实验结果**（论文报告）：StanWiFi 99.83%；MultiEnv 办公室 99.13%、大厅 98.67%；SimAct 95.1%（THAT 91.2%）。

---

## 2. 论文模块与代码对应

| 论文表述 | 代码位置 | 说明 |
|----------|----------|------|
| **双通道（振幅 + 相位）** | `train.py`：`CA_CSI_Model` / `KAN_CA_CSI_Model`；`models.py`：`TwoStreamModel` | 两路输入 `x_amp`、`x_phase`，分别经 stream1、stream2 提取特征后融合，对应论文双通道。 |
| **相位解缠** | `data_loader.py`：`load_numpy_data()` 中 `np.unwrap(x_phase, axis=1)` | 与论文 1.2.1 相位解卷绕一致。 |
| **GRE（时间位置编码）** | `position_encoding.py`：`GRE`；`models.py` 中 THATModel 使用 GRE | 论文中“时间通道维度”的 GRE；当前 **KAN_CA_CSI 使用的 TwoStreamModel 为可学习位置编码**，未用 GRE，若需与论文完全一致可改用 GRE。 |
| **可学习位置编码 LPE** | `position_encoding.py`：`LearnablePositionalEncoding`；`models.py`：`TwoStreamModel` 中 `pos_encoding` / `pos_encoding_v` | 论文中“特征通道维度”的 LPE；代码中用于水平/垂直序列的位置编码。 |
| **MCAT（时间维注意力+多尺度卷积）** | `mcat.py`：`MCAT`（MultiHeadAttention + HAR_CNN）；`models.py`：`TwoStreamModel.transformer` | 论文“时间通道维度”的 MCAT，对应代码中的水平流 Transformer。 |
| **垂直流 / 通道维建模** | `models.py`：`TwoStreamModel` 的垂直分支 `v_transformer`；`transformer_encoder.py`：`Transformer`（含 `RelativeMultiHeadAttention`） | 论文中通道维的“相对位置注意力”在代码中体现为垂直 Transformer 与相对位置注意力。MRPT 在论文中为独立模块，代码中通过垂直流 + 卷积聚合实现通道维建模。 |
| **KAN-GRN 融合** | `kan_grn.py`：`KAN_GatesResidualNetwork`；`WaveletKAN.py`：`WaveletKANLinear` | 论文 1.4：GRN 中线性层替换为 KAN；代码用 **WaveletKAN** 作为可学习基函数实现 KAN，与论文“可学习基函数”一致。 |
| **门控残差 GRN** | `grn.py`：`GatesResidualNetwork`；`kan_grn.py`：`KAN_GatesResidualNetwork` | 论文公式 (10)(11) 门控残差；KAN_CA_CSI 使用 KAN 版，CA_CSI 使用 MLP 版。 |
| **DWConv（深度可分离卷积）** | 当前代码未单独实现 DWConv 模块 | 论文在双流末端用 DWConv 做轻量融合；代码在双流末端为 1D 卷积 + 池化 + `feature_proj` 到 256 维，若需与论文一致可在双流输出后增加 DWConv 再进 KAN-GRN。 |
| **数据格式与划分** | `data_loader.py`：`load_numpy_data`、`get_dataloader`；`get_class_names` 中 wjq/our/stan | 幅度/相位/标签 npy；8:2 划分；SimAct 对应 wjq 等 6 类（挥手、招手、推、拉、坐下、蹲下）。 |

---

## 3. 模型名称对应

| 论文 | 代码 |
|------|------|
| PA-TCNet（完整模型） | **KAN_CA_CSI**（双流 + KAN-GRN） |
| 仅振幅的单流基线 | **THAT_CSI**（单流，仅幅度） |
| 双流 + 线性/MLP 门控融合 | **CA_CSI**（双流 + GRN，无 KAN） |

---

## 4. 数据与预处理

- **论文**：低通滤波(3–6Hz)、汉明窗、卡尔曼滤波；时间对齐至 maxlen=2000；滑窗长度 1000、步长 150；相位解缠 + 去线性漂移。  
- **代码**：`data_loader` 中实现相位解缠；幅度/相位由 npy 直接加载。**复合滤波、去线性漂移、滑窗**若需与论文一致，可在数据预处理脚本或 `data_loader` 前处理中自行添加。

---

## 5. 小结

- **KAN_CA_CSI** 即论文 PA-TCNet 的代码实现主线：双通道（振幅/相位）、双流 Transformer（MCAT + 垂直流）、**KAN-GRN**（WaveletKAN + 门控残差）均已在代码中实现。  
- 差异点：① 代码中双流主干使用 **LearnablePositionalEncoding**，论文还强调 GRE 用于时间维，可按需在时间维改用 GRE；② 论文中的 **DWConv** 在代码中未单独实现，目前为卷积 + 投影；③ 数据预处理（滤波、去漂移、滑窗）需在数据侧按论文补充即可与实验设置完全对齐。  

以上对应关系可用于复现论文、写方法部分或做消融时在代码中快速定位模块。
